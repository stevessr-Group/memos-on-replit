import{u as z,b as U,d as P,i as A,r as l,j as e,I as B,k as F,B as E,L as _,A as q,l as D,m as R,n as c,o as T,p as G}from"./index-b7fe78e2.js";const O=()=>{const{t:a}=z(),d=U(),m=P(),n=A(!1),{appearance:j,locale:y,systemStatus:s}=d.state,x=s.profile.mode,[r,f]=l.useState(""),[o,g]=l.useState(""),[p,b]=l.useState([]);l.useEffect(()=>{(async()=>{const{data:i}=await D();b(i)})()},[]),l.useEffect(()=>{x==="demo"&&(f("demohero"),g("secret"))},[x]);const v=t=>{const i=t.target.value;f(i)},N=t=>{const i=t.target.value;g(i)},L=t=>{d.setLocale(t)},k=t=>{d.setAppearance(t)},C=t=>{t.preventDefault(),s!=null&&s.host?h():w()},h=async()=>{if(!(r===""||o==="")&&!n.isLoading){try{n.setLoading(),await R(r,o),await m.doSignIn()?window.location.href="/":c.error(a("message.login-failed"))}catch(t){console.error(t),c.error(t.response.data.message||a("message.login-failed"))}n.setFinish()}},w=async()=>{if(!(r===""||o==="")&&!n.isLoading){try{n.setLoading(),await T(r,o),await m.doSignIn()?window.location.href="/":c.error(a("common.signup-failed"))}catch(t){console.error(t),c.error(t.response.data.message||t.message||a("common.signup-failed"))}n.setFinish()}},I=async t=>{const i=`auth.signin.${t.name}-${t.id}`;if(t.type==="OAUTH2"){const S=G("/auth/callback"),u=t.config.oauth2Config,$=`${u.authUrl}?client_id=${u.clientId}&redirect_uri=${S}&state=${i}&response_type=code&scope=${encodeURIComponent(u.scopes.join(" "))}`;window.location.href=$}};return e.jsx("div",{className:"flex flex-row justify-center items-center w-full h-full dark:bg-zinc-800",children:e.jsxs("div",{className:"w-80 max-w-full h-full py-4 flex flex-col justify-start items-center",children:[e.jsxs("div",{className:"w-full py-4 grow flex flex-col justify-center items-center",children:[e.jsxs("div",{className:"flex flex-col justify-start items-start w-full mb-4",children:[e.jsxs("div",{className:"w-full flex flex-row justify-start items-center mb-2",children:[e.jsx("img",{className:"h-12 w-auto rounded-lg mr-1",src:s.customizedProfile.logoUrl,alt:""}),e.jsx("p",{className:"text-6xl tracking-wide text-black opacity-80 dark:text-gray-200",children:s.customizedProfile.name})]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:s.customizedProfile.description||a("common.memos-slogan")})]}),e.jsxs("form",{className:"w-full",onSubmit:C,children:[e.jsxs("div",{className:`flex flex-col justify-start items-start w-full ${n.isLoading&&"opacity-80"}`,children:[e.jsxs("div",{className:"flex flex-col justify-start items-start relative w-full text-base mt-2 py-2",children:[e.jsx("span",{className:`absolute top-3 left-3 px-1 leading-10 shrink-0 text-base cursor-text text-gray-400 transition-all select-none pointer-events-none ${r?"!text-sm !top-0 !z-10 !leading-4 bg-white dark:bg-zinc-800 rounded":""}`,children:a("common.username")}),e.jsx("input",{className:"input-text w-full py-3 px-3 text-base rounded-lg dark:bg-zinc-800",type:"text",value:r,onChange:v,required:!0})]}),e.jsxs("div",{className:"flex flex-col justify-start items-start relative w-full text-base mt-2 py-2",children:[e.jsx("span",{className:`absolute top-3 left-3 px-1 leading-10 shrink-0 text-base cursor-text text-gray-400 transition-all select-none pointer-events-none ${o?"!text-sm !top-0 !z-10 !leading-4 bg-white dark:bg-zinc-800 rounded":""}`,children:a("common.password")}),e.jsx("input",{className:"input-text w-full py-3 px-3 text-base rounded-lg dark:bg-zinc-800",type:"password",value:o,onChange:N,required:!0})]})]}),e.jsxs("div",{className:"flex flex-row justify-end items-center w-full mt-2",children:[n.isLoading&&e.jsx(B.Loader,{className:"w-4 h-auto mr-2 animate-spin dark:text-gray-300"}),(s==null?void 0:s.allowSignUp)&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:`btn-text ${n.isLoading?"cursor-wait opacity-80":""}`,onClick:w,children:a("common.sign-up")}),e.jsx("span",{className:"mr-2 font-mono text-gray-200",children:"/"})]}),e.jsx("button",{type:"submit",className:`btn-primary ${n.isLoading?"cursor-wait opacity-80":""}`,onClick:h,children:a("common.sign-in")})]})]}),p.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"!my-4",children:a("common.or")}),e.jsx("div",{className:"w-full flex flex-col space-y-2",children:p.map(t=>e.jsx(E,{variant:"outlined",color:"neutral",className:"w-full",size:"md",onClick:()=>I(t),children:a("common.sign-in-with",{provider:t.name})},t.id))})]}),!(s!=null&&s.host)&&e.jsx("p",{className:"w-full inline-block float-right text-sm mt-4 text-gray-500 text-right whitespace-pre-wrap",children:a("auth.host-tip")})]}),e.jsxs("div",{className:"flex flex-row items-center justify-center w-full gap-2",children:[e.jsx(_,{value:y,onChange:L}),e.jsx(q,{value:j,onChange:k})]})]})})};export{O as default};
