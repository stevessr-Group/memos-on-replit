import{T as v,F as m,P as h,_ as p,u as I,f as E,w as S,z as A,r as y,j as o,I as u,Y as N}from"./index-b7fe78e2.js";const j=[{text:"filter.and",value:"AND"},{text:"filter.or",value:"OR"}],g={TAG:{text:"filter.type.tag",value:"TAG",operators:[{text:"filter.operator.contains",value:"CONTAIN"},{text:"filter.operator.not-contains",value:"NOT_CONTAIN"}]},TYPE:{text:"filter.type.type",value:"TYPE",operators:[{text:"filter.operator.is",value:"IS"},{text:"filter.operator.is-not",value:"IS_NOT"}],values:[{text:"filter.value.not-tagged",value:"NOT_TAGGED"},{text:"filter.value.linked",value:"LINKED"},{text:"filter.value.has-attachment",value:"HAS_ATTACHMENT"}]},TEXT:{text:"filter.type.text",value:"TEXT",operators:[{text:"filter.operator.contains",value:"CONTAIN"},{text:"filter.operator.not-contains",value:"NOT_CONTAIN"}]},DISPLAY_TIME:{text:"filter.type.display-time",value:"DISPLAY_TIME",operators:[{text:"filter.operator.before",value:"BEFORE"},{text:"filter.operator.after",value:"AFTER"}]},VISIBILITY:{text:"filter.type.visibility",value:"VISIBILITY",operators:[{text:"filter.operator.is",value:"IS"},{text:"filter.operator.is-not",value:"IS_NOT"}],values:[{text:"memo.visibility.public",value:"PUBLIC"},{text:"memo.visibility.protected",value:"PROTECTED"},{text:"memo.visibility.private",value:"PRIVATE"}]}},O=g.TYPE.values,C=i=>{for(const n of O)if(n.value===i)return n.text;return""},L=()=>({type:"TAG",value:{operator:"CONTAIN",value:""},relation:"AND"}),M=(i,n)=>{let e=!0;for(const l of n){const{relation:s}=l,r=_(i,l);s==="OR"?e=e||r:e=e&&r}return e},_=(i,n)=>{const{type:e,value:{operator:l,value:s}}=n;if(s==="")return!0;let r=!0;if(e==="TAG"){let t=!0;const c=new Set;for(const f of Array.from(i.content.match(new RegExp(v,"g"))??[])){const T=f.replace(v,"$1").trim().split("/");let a="";for(const d of T)a+=d,c.add(a),a+="/"}c.has(s)||(t=!1),l==="NOT_CONTAIN"&&(t=!t),r=t}else if(e==="TYPE"){let t=!1;(s==="NOT_TAGGED"&&i.content.match(v)===null||s==="LINKED"&&(i.content.match(m)!==null||i.content.match(h))!==null||s==="HAS_ATTACHMENT"&&i.resourceList.length>0)&&(t=!0),l==="IS_NOT"&&(t=!t),r=t}else if(e==="TEXT")if(s.startsWith("^")){const t=new RegExp(s.slice(1));r=l==="NOT_CONTAIN"?!t.test(i.content):t.test(i.content)}else{let t=i.content.toLowerCase().includes(s.toLowerCase());l==="NOT_CONTAIN"&&(t=!t),r=t}else{if(e==="DISPLAY_TIME")return l==="BEFORE"?i.displayTs<p(s):i.displayTs>=p(s);if(e==="VISIBILITY"){let t=i.visibility===s;l==="IS_NOT"&&(t=!t),r=t}}return r};const R=()=>{const{t:i}=I(),n=E(),e=S(),l=A(),s=e.state,{tag:r,duration:t,type:c,text:f,shortcutId:x,visibility:T}=s,a=x?l.getShortcutById(x):null,d=!!(r||t&&t.from<t.to||c||f||a||T);return y.useEffect(()=>{e.clearFilter()},[n]),o.jsxs("div",{className:`filter-query-container ${d?"":"!hidden"}`,children:[o.jsxs("span",{className:"mx-2 text-gray-400",children:[i("common.filter"),":"]}),o.jsxs("div",{className:"filter-item-container "+(a?"":"!hidden"),onClick:()=>{e.setMemoShortcut(void 0)},children:[o.jsx(u.Target,{className:"icon-text"})," ",a==null?void 0:a.title]}),o.jsxs("div",{className:"filter-item-container "+(r?"":"!hidden"),onClick:()=>{e.setTagFilter(void 0)},children:[o.jsx(u.Tag,{className:"icon-text"})," ",r]}),o.jsxs("div",{className:"filter-item-container "+(c?"":"!hidden"),onClick:()=>{e.setMemoTypeFilter(void 0)},children:[o.jsx(u.Box,{className:"icon-text"})," ",i(C(c))]}),o.jsxs("div",{className:"filter-item-container "+(T?"":"!hidden"),onClick:()=>{e.setMemoVisibilityFilter(void 0)},children:[o.jsx(u.Eye,{className:"icon-text"})," ",T]}),t&&t.from<t.to?o.jsxs("div",{className:"filter-item-container",onClick:()=>{e.setFromAndToFilter()},children:[o.jsx(u.Calendar,{className:"icon-text"}),i("common.filter-period",{from:N(t.from),to:N(t.to),interpolation:{escapeValue:!1}})]}):null,o.jsxs("div",{className:"filter-item-container "+(f?"":"!hidden"),onClick:()=>{e.setTextFilter(void 0)},children:[o.jsx(u.Search,{className:"icon-text"})," ",f]})]})};export{R as M,M as c,g as f,L as g,j as r};
